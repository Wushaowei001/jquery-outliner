(function(e){var d="bgOutliner";var c={addAsChild:false,addClass:"add-node",childHtml:'<td class="%dataCellClass%"><span class="add-edit-icons"><a href="#" title="Add node" class="%addClass%"><img src="../images/add.gif" alt="Add node" width="12" height="12" /></a><a href="#" title="Remove node" class="%removeClass%"><img src="../images/trash.gif" alt="Remove node" width="16" height="16" /></a></span><span class="%expColIconClass%"></span><span class="%dataClass%">Ny artikel</span></td><td></td><td></td>',childOfClassPrefix:"child-of-",collapsedClass:"collapsed",dataName:"data",dataClass:"nested-data",dataCellClass:"nested-data-cell",dragAndDrop:true,dragHandle:false,edit:true,expandCollapse:true,expandedClass:"expanded",expColIconClass:"expand-collapse-icon",hasChildrenClass:"has-children",hoverClass:"hover",idPrefix:"row",indent:20,initHidden:true,interval:30,levelClassPrefix:"level",onAddNode:false,onAppend:false,onBlur:false,onDelete:false,onDestroy:false,onDrop:false,onInit:false,onInsertBefore:false,onInsertAfter:false,prepend:false,removeClass:"remove-node",tolerance:1};var f=function(g){if(!g.data(d)){throw new Error("jQuery."+d+" Instance Error. Element is not an instance of jQuery."+d)}return true};var a=function(h,g){if(g===undefined||!g.parent().is("#"+h.attr("id"))){throw new Error("jQuery."+d+" Error. Element is not child of instanced element")}return true};var b={init:function(g){return this.each(function(){var j=e(this),i=j.data(d);if(i){throw new Error("jQuery."+d+" Init Error. Supplied element is already and instance of jQuery."+d)}if(j.children("tr").length<=0){throw new Error("jQuery."+d+" Init Error. Supplied element is not parent to any tr elements")}j.data(d,{settings:c});if(g){e.extend(j.data(d).settings,g)}g=j.data(d).settings;var h;if(g.initHidden){j.find("tr[class*='"+g.childOfClassPrefix+"']").hide();h=g.collapsedClass}else{h=g.expandedClass}j.find("tr[class*='"+g.hasChildrenClass+"']").addClass(h);j.find("tr").each(function(){j.bgOutliner("setIndentation",e(this))});j.find("tr."+g.hasChildrenClass+" ."+g.dataCellClass+" ."+g.expColIconClass).live("click."+d,function(k){j.bgOutliner("toggleNode",e(this).closest("tr"));k.preventDefault()});j.find("tr").live("mouseover."+d,function(k){e(this).addClass(g.hoverClass)}).live("mouseout."+d,function(k){e(this).removeClass(g.hoverClass)});if(g.edit===true){j.bgOutliner("initEdit")}if(e.isFunction(g.onInit)){g.onInit.call(this)}})},initEdit:function(){var x=this;f(x);var s=x.data(d),q=s.settings;var n='<div class="drop-indicator-bar"><div class="col-indicator"><div class="thick-rule"></div></div><div class="row-indicator"><div class="thin-rule"></div></div></div>';s.dropIndicator=e(n);e("body").append(s.dropIndicator);s.dropIndicator.offset(x.offset());s.dropIndicator.width(x.outerWidth());var j,m,w,t={x:0,y:0},p=0,u,v,r={top:0,left:0},g,l,i,h=0;s.leftColumn=x.find("tr:first ."+q.expColIconClass).offset().left;s.iconSize=x.find("tr:first ."+q.expColIconClass).width();s.topPosition=x.find("tr:first").offset().top;var k={appendTo:"body",revert:"invalid",revertDuration:0,drag:function(z,y){h=new Date().getTime();if(q.interval>h-p){return}p=h;i={x:z.pageX,y:z.pageY};if(t.x===i.x&&t.y===i.y){return}t=i;j=0;w=0;v=0;l=0;m=null;g=null;x.find("tr").each(function(){this.proportions={width:this.offsetWidth,height:this.offsetHeight};this.offset=e(this).offset();var A=e.ui.intersect(e.ui.ddmanager.current,this,"pointer");if(A){e(this).addClass(q.hoverClass)}else{e(this).removeClass(q.hoverClass)}});m=x.find("."+q.hoverClass+":first");u=i.x-s.leftColumn;if(u<=0){j=0}else{j=u/q.indent}j=parseInt(j,10);if(m.length>0){w=x.bgOutliner("getLevel",m);if(j>w+1){j=w+1}}else{j=0}s.invalidDropPositions=x.bgOutliner("getInvalidDropPositions",e(z.target).closest("tr"),j);if(s.invalidDropPositions.indexOf(m.index()+1)!==-1){j=x.bgOutliner("getLevel",x.find("tr:eq("+(s.invalidDropPositions[0]-1)+")"))}s.dropPositionsForLevel=x.bgOutliner("getDropPositionsForLevel",j);s.dropPositions=s.dropPositionsForLevel.filter(function(B,A){return s.invalidDropPositions.indexOf(B)===-1});e.each(s.dropPositions,function(A,B){if(m.index()===(B-1)){g=x.find("tr:eq("+(B-1)+")");return false}return});v=j;if(g!==null&&g.length>0){r.top=parseInt(g.offset().top+g.height()-(s.dropIndicator.height()/2),10);r.left=x.offset().left;x.bgOutliner("showDropIndicator",r,v);s.target="after";s.targetRow=g;s.targetLevel=v;s.droppedNode=e(z.target)}else{if(i.y<s.topPosition){r.top=parseInt(s.topPosition-(s.dropIndicator.height()/2),10);r.left=x.offset().left;x.bgOutliner("showDropIndicator",r,v);s.target="before";s.targetRow=x.find("tr:first");s.targetLevel=v;s.droppedNode=e(z.target)}else{if(i.y>s.topPosition){v=0;g=x.find("tr:last");r.top=parseInt(x.find("tr:visible:last").offset().top+x.find("tr:visible:last").height()-(s.dropIndicator.height()/2),10);r.left=x.offset().left;x.bgOutliner("showDropIndicator",r,v);s.target="after";s.targetRow=g;s.targetLevel=0;s.droppedNode=e(z.target)}}}},stop:function(z,y){x.bgOutliner("hideDropIndicator");x.bgOutliner("insertAt",s.targetRow,s.targetLevel,s.droppedNode,s.target)},helper:function(z,y){var A=e('<div class="nested-table-item-dragging"><table class="'+d+'-dragging"></table></div>').find("table").append(e(z.target).closest("tr").clone().removeClass(x.data(d).settings.hoverClass));return A}};if(q.dragHandle!==false){k.handle=q.dragHandle}x.find("tr").draggable(k).data(d,true);x.find("tr").live("hover."+d,function(){if(e(this).data(d)!==true){e(this).data(d,true);e(this).draggable(k)}});x.find("."+c.dataCellClass+" ."+c.addClass).live("click."+d,function(y){x.bgOutliner("addNode",e(this).closest("tr"));y.preventDefault()});x.find("."+c.dataCellClass+" ."+c.removeClass).live("click."+d,function(y){x.bgOutliner("removeNode",e(this).closest("tr"));y.preventDefault()});return x},destroy:function(){return this.each(function(){var i=e(this),h=i.data(d);f(i);var g=i.data(d).settings;i.find("tr."+g.hasChildrenClass+" ."+g.dataCellClass+" ."+g.expColIconClass).die("click."+d);i.find("tr").die("hover."+d);if(g.edit===true){if(h.dropIndicator){h.dropIndicator.remove()}i.find("tr").draggable("destroy").removeData(d);i.find("."+c.dataCellClass+" ."+c.removeClass).die("click."+d);i.find("."+c.dataCellClass+" ."+c.addClass).die("click."+d)}if(e.isFunction(g.onDestroy)){g.onDestroy.call(this)}i.removeData(d)})},updateSettings:function(g){return this.each(function(){var h=e(this);f(h);if(g){e.extend(h.data(d).settings,g)}})},toggleNode:function(g){var h=this;f(h);a(h,g);g.toggleClass(h.data(d).settings.expandedClass);g.toggleClass(h.data(d).settings.collapsedClass);h.bgOutliner("toggleDescendants",g);return h},toggleDescendants:function(g){var k=this;f(k);a(k,g);var j=k.data(d).settings;var i=g.attr("id"),h=k.find("."+j.childOfClassPrefix+i+"."+k.data(d).settings.expandedClass);if(h.length>0){h.each(function(){k.bgOutliner("toggleDescendants",e(this))})}this.find("."+j.childOfClassPrefix+i).each(function(){e(this).toggle()});return k},expandNode:function(g){var i=this;f(i);a(i,g);var h=i.data(d).settings;if(g.hasClass(h.collapsedClass)){i.bgOutliner("toggleNode",g)}g.removeClass(h.collapsedClass).addClass(h.expandedClass);return i},collapseNode:function(g){var i=this;f(i);a(i,g);var h=i.data(d).settings;if(g.hasClass(h.expandedClass)){i.bgOutliner("toggleNode",g)}g.removeClass(h.expandedClass).addClass(h.collapsedClass);return i},expandAll:function(){var h=this;f(h);var g=h.data(d).settings;h.find("tr."+g.hasChildrenClass).each(function(){h.bgOutliner("expandNode",e(this))});return h},collapseAll:function(){var h=this;f(h);var g=h.data(d).settings;var i=h.find("tr."+g.hasChildrenClass+":visible").get().reverse();e.each(i,function(){h.bgOutliner("collapseNode",e(this))});return h},addNode:function(l){var q=this;f(q);if(l){a(q,l)}var i,h,m,n,r,k,g,s;var j=q.data(d).settings;if(j.addAsChild===false){var p=q.bgOutliner("getParent",l);l=(p!==null)?q.find("#"+j.idPrefix+p):null}if(l){q.bgOutliner("expandNode",l);h=q.bgOutliner("getLevel",l)+1;s=l.attr("id")}else{h=0;s=null}m=0;q.find("tr").each(function(){n=parseInt(e(this).attr("id").substring(j.idPrefix.length),10);m=(m<n)?n:m});m++;k=j.idPrefix+m.toString();r=j.childHtml.replace(/%dataCellClass%/ig,j.dataCellClass).replace(/%addClass%/ig,j.addClass).replace(/%removeClass%/ig,j.removeClass).replace(/%expColIconClass%/ig,j.expColIconClass).replace(/%dataClass%/ig,j.dataClass);g='<tr id="'+k+'" class="';if(s!==null){g=g+j.childOfClassPrefix+s+" "}g=g+j.levelClassPrefix+h+'">'+r+"</tr>";i=e(g);if(l){q.bgOutliner("appendNode",l,i)}else{if(j.prepend){q.prepend(i)}else{q.append(i)}}if(e.isFunction(j.onAddNode)){j.onAddNode.call(this,i,l)}return q},removeNode:function(g){var k=this;f(k);a(k,g);var j=k.data(d).settings;var h=k.bgOutliner("getParent",g);var i=k.find("."+j.childOfClassPrefix+j.idPrefix+h);if(i.length<=1){k.find("#"+j.idPrefix+h).removeClass(j.hasChildrenClass)}if(g.hasClass(j.hasChildrenClass)){k.find("."+j.childOfClassPrefix+g.attr("id")).each(function(){k.bgOutliner("removeNode",e(this))})}if(e.isFunction(j.onRemoveNode)){j.onRemoveNode.call(this,g)}g.remove();return k},appendNode:function(g,j){var n=this;f(n);a(n,g);var m=[j],l,h,i=g.index();var k=n.data(d).settings;if(j.parent().is("#"+n.attr("id"))){m=n.bgOutliner("getFamily",j);n.bgOutliner("setParent",g,j)}if(g.hasClass(k.hasChildrenClass)){if(!k.prepend){l=n.bgOutliner("getFamily",g);h=l[l.length-1];i=h.index()}}else{g.addClass(k.hasChildrenClass);n.bgOutliner("expandNode",g)}e.each(m,function(){e(this).insertAfter(n.find("tr:eq("+i+")"));n.bgOutliner("setIndentation",e(this));i++});if(e.isFunction(k.onAppend)){k.onAppend.call(this,j,g)}},insertAt:function(k,i,j,h){var q=this;f(q);a(q,k);a(q,j);var l=q.data(d).settings;var s=q.bgOutliner("getFamily",j),p,g=q.bgOutliner("getLevel",j),n,m=q.bgOutliner("getParent",j),r=q.find("."+l.childOfClassPrefix+l.idPrefix+m);if(r.length<=1){q.find("#"+l.idPrefix+m).removeClass(l.hasChildrenClass)}n=(i===0)?null:k.add(k.prevAll()).filter("."+l.levelClassPrefix+(i-1)).last();if(n!==null){if(!n.hasClass(l.hasChildrenClass)){n.addClass(l.hasChildrenClass)}q.bgOutliner("expandNode",n)}j.removeClass(l.levelClassPrefix+g).addClass(l.levelClassPrefix+i);q.bgOutliner("setIndentation",j);q.bgOutliner("setParent",n,j);if(k.is("#"+j.attr("id"))){k=k.prevAll().first()}if(h==="before"){q.prepend(j);p=0}else{j.insertAfter(k);p=k.index()+1}s.shift();e.each(s,function(){e(this).insertAfter(q.find("tr:eq("+p+")"));q.bgOutliner("setLevel",e(this)).bgOutliner("setIndentation",e(this));p=e(this).index()});if(e.isFunction(l.onDrop)){l.onDrop.call(this,j,n,p)}return q},getFamily:function(g){var k=this;f(k);a(k,g);var h=k.data(d).settings;var j=[g],i=[];k.find("."+h.childOfClassPrefix+g.attr("id")).each(function(){if(e(this).hasClass(h.hasChildrenClass)){i=k.bgOutliner("getFamily",e(this));e.each(i,function(){j.push(e(this))})}else{j.push(e(this))}});return j},getParent:function(h){var k=this;f(k);a(k,h);var i,g,m,l;var j=k.data(d).settings;l=h.attr("class");if(l.indexOf(j.childOfClassPrefix)!==-1){m=l.indexOf(j.childOfClassPrefix)+j.childOfClassPrefix.length+j.idPrefix.length;g=l.indexOf(" ",m);i=(g!==-1)?parseInt(l.substring(m,g),10):parseInt(l.substring(m),10)}else{i=null}return i},getLevel:function(i){var l=this;f(l);a(l,i);var h,g,m,k,j;j=l.data(d).settings;k=i.attr("class");m=k.indexOf(j.levelClassPrefix)+j.levelClassPrefix.length;g=k.indexOf(" ",m);h=(-1!==g)?parseInt(k.substring(m,g),10):parseInt(k.substring(m),10);return h},setParent:function(k,h){var l=this;f(l);a(l,h);var i=l.data(d).settings;var j=h.attr("class");var m=j.indexOf(i.childOfClassPrefix);var g=j.indexOf(" ",m);if(-1===m){j=false}else{j=(-1!==g)?j.substring(m,g):j.substring(m)}h.removeClass(j);if(k!==null){h.addClass(i.childOfClassPrefix+k.attr("id"))}return l},setLevel:function(i){var l=this;f(l);a(l,i);var j=l.data(d).settings;var g=l.bgOutliner("getLevel",i),h=l.bgOutliner("getParent",i),k=l.bgOutliner("getLevel",e("#"+j.idPrefix+h))+1;i.removeClass(j.levelClassPrefix+g).addClass(j.levelClassPrefix+k);return l},setIndentation:function(g){var j=this;f(j);a(j,g);var h=j.data(d).settings;var i=h.indent*j.bgOutliner("getLevel",g);g.find("."+h.dataCellClass+" ."+h.expColIconClass).css("margin-left",i+"px");return j},hasChildren:function(g){var i=this;f(i);a(i,g);var h=i.data(d).settings;return g.hasClass(h.hasChildrenClass)},showDropIndicator:function(l,h){var k=this;f(k);var j=k.data(d).settings;var g=k.data(d).leftColumn-k.offset().left+(k.data(d).iconSize/2),i=g+(j.indent*(h));k.data(d).dropIndicator.show();k.data(d).dropIndicator.css({position:"absolute",top:l.top,left:l.left});k.data(d).dropIndicator.find(".col-indicator").width(i);k.data(d).dropIndicator.find(".row-indicator").width(k.data(d).dropIndicator.width()-i);return k},hideDropIndicator:function(){var g=this;f(g);g.data(d).dropIndicator.hide();return g},getDropPositionsForLevel:function(i){var l=this;f(l);var k=l.data(d).settings;var h=[],m,j,g;m=l.find("."+k.levelClassPrefix+i);if(i>0){j=l.find("."+k.levelClassPrefix+(i-1));j.each(function(){h.push(e(this).index()+1)})}else{h.push(0)}m.each(function(){if(l.bgOutliner("hasChildren",e(this))){g=l.bgOutliner("getFamily",e(this));h.push(g[g.length-1].index()+1)}else{h.push(e(this).index()+1)}});return h.unique().sort(function(p,n){return(p-n)})},getInvalidDropPositions:function(i,h){var l=this;f(l);a(l,i);var k,j,g=[];k=l.bgOutliner("getFamily",i);e.each(k,function(){g.push(e(this).index()+1)});j=l.bgOutliner("getLevel",i);while(h<j){g.pop();h++}return g}};e.fn.bgOutliner=function(g){if(b[g]){return b[g].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof g==="object"||!g){return b.init.apply(this,arguments)}else{throw new Error("Method "+g+" does not exist on jQuery."+d)}}}}(jQuery));if(!("filter" in Array.prototype)){Array.prototype.filter=function(d,e){var a=[],c,b,f;for(c=0,f=this.length;c<f;c++){if(c in this&&d.call(e,b=this[c],c,this)){a.push(b)}}return a}}if(!("indexOf" in Array.prototype)){Array.prototype.indexOf=function(b,a){if(a===undefined){a=0}if(a<0){a+=this.length}if(a<0){a=0}var c;for(c=this.length;a<c;a++){if(a in this&&this[a]===b){return a}}return -1}}if(!("unique" in Array.prototype)){Array.prototype.unique=function(){var c=[],b,a,e,d;o:for(b=0,e=this.length;b<e;b++){for(a=0,d=c.length;a<d;a++){if(c[a]===this[b]){return}}c[c.length]=this[b]}return c}};